\input{../../common/paper_begin.tex}%

\firstpassagedo{
\title{Introduction aux algorithmes de trading}
\author{Xavier Dupré \\ \httpstyle{http://www.xavierdupre.fr/}}
\maketitle
\begin{abstract}
\noindent Trend following, pair trading, gestion de portefeuille, ce document présente quelques algorithmes de trading. Il rappelle aussi quelques définitions couramment utilisées (volatilité, rendement, ratio de Sharpe). La conception de tels algorithmes, dont l'objectif avoué est de pouvoir faire du trading sans intervention humaine, requiert une certaine rigueur afin de s'assurer de la robustesse de la stratégie financière. C'est aussi un sujet que cet exposé aborde avec la description du back testing ou la prise en compte de coûts cachés (coûts de transaction, slippage) qui expliquent en partie que des stratégies ne soient pas aussi prometteuses que leur évaluation sur des données passées le laissait penser.
\end{abstract}
%\shorttableofcontents{Table des matières}{2}
\setcounter{tocdepth}{2}
\tableofcontents
\hypersetup{
    pdftitle={Introduction aux algorithmes de trading}
    pdfauthor={Xavier Dupré}
    pdfsubject={Introduction aux algorithmes de trading}
    pdfkeywords={Python finance algorithmes automation trading}
}
}



%-------------------------------------------------------------------------------------------------------------
\section{Stratégie automatique de trading en finance}
\label{finance_strategie_automatique}
%-------------------------------------------------------------------------------------------------------------
\indexfr{finance}\indexfrr{finance}{stratégie automatique}\indexfr{trading}\indexfr{strétégie}

Une stratégie automatique de trading désigne un algorithme qui propose voire prend des décisions de trading. Le rôle du trader consiste alors à concevoir et améliorer constamment son algorithme. Ce scénario est rendu possible grâce à l'évolution rapide des moyens informatiques qui vont jusqu'à utiliser des connexions internet ultra rapide (\citeindex{Verizon2013}). Ces techniques étaient plutôt la spécialité de certains \textit{Hedge Funds}\footnote{C'est le cas du Hedge Fund \textit{Renaissance}.} mais elles sont de plus en plus répandues.\indexfrr{finance}{Hedge Funds} Il va de soi qu'un tel système de trading automatique doit être réalisé avec le plus grand soin car les erreurs de conception ou les bugs ont un impact immédiat en terme financier. Cet automatisme extrême est impératif dans le cas de stratégie de type \textit{High Frequency Trading},\indexfrr{finance}{High Frequency Trading} qui réagissent en temps réel à la moindre variation des cours. Pour des stratégies à plus long terme, les algorithmes ne sont pas toujours directement reliés aux marchés, ils génèrent des listes d'ordres qui sont effectués manuellement par un trader ou servent d'outils d'aide à la décision. Plus la fréquence des opérations est élevée, plus l'investissement nécessaire à leur mise en place est important. 

\subsection{Quelques références}

En pratique, l'efficacité d'une stratégie est souvent limitée dans le temps, il faut sans cesse améliorer les stratégies existantes et en imaginer d'autres. Les paragraphes qui suivent donne une première idée de ce en quoi consiste la construction d'un tel algorithme. Il existe un grand nombre de livres décrivant le monde de la finance, cette partie succinte ne prétend pas en donner un reflet exhaustif, elle s'intéresse à un aspect en particulier qui est celui du trading automatique. Un livre est considéré comme la bible en finance, il s'agit de \textit{Options Futures et autres actifs dérivés} de John Hull (\citeindex{Hull2011}). Le livre \textit{La finance quantitative en 50 questions} de Paul Wilmott (\citeindex{Wilmott2008}) aborde cinquante thèmes ou questions récurrentes en finance. Ce second livre se conclut par des conseils concernant la rédaction d'un CV ou des questions types utilisées lors des entretiens pour tester la vivacité d'esprit des candidats. Un autre livre autour des Hedge Funds\indexfrr{finance}{Hedge Funds} intitulé \textit{Hedge funds, private equity, marchés financiers les frères ennemis~?} dirigé par Bertrand Jacquillat (\citeindex{Jacquillat2008}), c'est un recueil d'articles autour de l'utilité des Hedge Funds au sein du système économique et financier mondial, l'un d'eux se penche sur des moyens de mieux réguler leur activité pour l'instant peu contrainte. Un tiers des Hedge Fund en 2007 était établi dans les Iles Caymans. Je citerai également deux autres livres concernant les Hedge Funds. Le premier \textit{Hedge Funds, tome 1, Histoire de la gestion alternative et de ses techniques} de Rocchi et Christiaens (\citeindex{RocchiChristiaens2007}) décrit les différents style de gestion des Hedge Funds, il revient également sur les personnalités qui ont marqué l'histoire des Hedge Funds. Le second \textit{Hedge Funds} de Gérard-Marie Henry (\citeindex{Henry2008}) aborde les mêmes thèmes mais est mieux structuré.

Ayant quitté la finance en 2007, je connais peu de références récentes qui auraient pu aborder la crise des subprimes. La démarche décrite ici est toujours valable mais des livres récents seraient plus précis à propos des évolutions informatiques et des indicateurs intéressants à surveiller en temps de crise.


\subsection{Vocabulaire financier}

\subsubsection{Marchés liquides}

Les algorithmes de trading sont de préférence utilisés sur des marchers financiers liquides et sur des produits standards tels que les actions, les Futures\footnote{Les Futures sont des produits financiers reliés à un sous-jacent qui ne sera échangé entre le vendeur et l'acheteur qu'à une date ultérieure qu'on appelle \textit{maturité}\indexfrr{finance}{maturité}. Lorsqu'on achète un produit Future sur du pétrole par exemple, on s'engage en fait à acheter ce dit pétrole à une date fixée par le contrat. Au moment de la transaction, il n'est pas nécessaire d'avoir effectivement l'argent, on pourra toujours clore ce contract avant d'avoir à acheter réellement le pétrole. A cause de la spéculation financière, il y a bien plus de contrats ouverts que de pétrole disponible.}, les devises\footnote{Parier sur une devise, c'est parier son évolution par rapport à une autre devise, par exemple, le cours Euro/Dollars.} ou encore les taux d'intéret\footnote{Les taux d'intérêt ne sont pas les mêmes d'un pays à l'autre, ces taux ne sont pas non plus constants dans le temps.}.\indexfrr{finance}{action}\indexfrr{finance}{Future}\indexfrr{finance}{taux d'intérêt}\indexfrr{finance}{devises} Des produits simples et liquides limitent considérablement les contraintes associées à leur trading. L'algorithme en sera d'autant moins compliqué à concevoir et à surveiller.

La liquidité\indexfrr{finance}{liquidité} est une caractéristique essentielle, elle détermine la facilité avec laquelle on peut vendre et acheter un produit financier. On fait souvent la distinction entre \textit{large cap}, \textit{mid cap}, \textit{small cap}, c'est-à-dire les grandes capitalisations boursières, les moyennes et les petites.\indexfrr{finance}{capitalisation}\indexfrr{finance}{large cap}\indexfrr{finance}{mid cap}\indexfrr{finance}{small cap} Sur le  secteur des \textit{small cap}, il n'est pas toujours possible de trouver un acheteur ou un vendeur pour une action donnée. Cela ne veut pas dire que le prix de cette action est momentanément nul, cela signifie que, momentanément, il n'existe personne sur le marché pour échanger. La liquidité n'est pas une caractéristique constante, il peut arriver qu'un marché soit liquide la plupart du temps et qu'il ne le soit plus en temps de crise.

\subsubsection{Description d'une série financière}

Une série financière ne se résume pas à une série de prix. Pour une série quotidienne, on dispose d'autres informations comme le premier prix de la journée (Open), le dernier prix (Close), le plus haut prix (High) et le plus bas (Low). Une autre information importante est le volume de transactions. La figure~\ref{finance_graph_ohlc_figure0} représente toutes ces informations sur un seul graphique pour une vingtaine de jours.

				\begin{figure}[ht]
				\begin{center}\begin{tabular}{|c|}\hline
    		\includegraphics[height=4cm, width=12cm]{\filext{../python_cours_exemple/image/ohlc}} \\ \hline
    		\end{tabular}\end{center}
    		\caption{ Graphe \textit{Open-High-Low-Close-Volume} d'une série financière. Les histogrammes représentant les 
    							les volumes, vert pour journée positive, rouge pour une journée négative. Chaque barre verticale
    							relie les prix Low et High d'une même journée, les barres horizontales sont les prix Open à gauche et 
    							Close à droite.}
    		\label{finance_graph_ohlc_figure0}
    		\end{figure}
    		
    		

Cette représentation est valable quelque soit la période de la série, que ce soit un jour, cinq minutes, il existe toujours quatre prix, Open High Low Close. Ces mêmes données sur des périodes de cinq minutes peuvent être utilisées pour faire du trading intraday~: le trader quitte toutes ses positions chaque soir et ne s'intéresse qu'aux variations des prix au sein d'une même journée.\indexfrr{finance}{intraday} La figure~\ref{finance_graph_ohlc_figure_intraday} représente deux jours d'une telle série. Ce graphe montre que le volume de transactions n'est pas constant, il est souvent élevé lorsque marchés européens et américains sont ouverts ensemble, il est également très élevé lorsque les acteurs du marchés attendent une information financière comme l'annonce d'une baisse des taux ou l'indice de satisfaction des ménages américains\footnote{Le site \httpstyle{http://www.abcbourse.com/marches/stats\_eco.aspx} répertorie quelques statistiques économiques, principalement américaines, qui sont observées attentivement par les marchés financiers. Une valeur plus haute ou plus basse qu'attendue peut entraîner temporairement de gros volumes d'échanges et de grandes variations de prix sur la plupart des marchés.}.

				\begin{figure}[ht]
				\begin{center}\begin{tabular}{|c|}\hline
    		\includegraphics[height=4cm, width=12cm]{\filext{../python_cours_exemple/image/intraday}} \\ \hline
    		\end{tabular}\end{center}
    		\caption{ Graphe \textit{Open-High-Low-Close-Volume} d'une série financière intraday. 
    							Les volumes représentés ici sont ceux d'une série européenne, 
    							il y a une première vague avant midi, juste avant la 
    							pause déjeuner, il y a une seconde vague qui correspond à l'ouverture des marchés américains. Certaines 
    							statistiques américaines tombe parfois à 13h30 heure française et ont un fort impact 
    							très localisé dans le temps sur les séries financières les plus traitées.}
    		\label{finance_graph_ohlc_figure_intraday}
    		\end{figure}
    		
Certains organismes financiers bâtissent des stratégies qui nécessitent des données encore plus précises qu'on appelle données  \textit{tick by tick}.\indexfrr{finance}{tick by tick} Un tick est un ordre exécuté, il correspond à une quantité et un prix, ce prix est la valeur de l'action jusqu'au prochain tick. Ainsi les quatre prix Open High Low Close sur une période sont calculées à partir des données tick by tick. Ces données sont très volumineuses et nécessitent des systèmes informatiques spécialisés. Elles sont aussi bruitées, il arrive parfois qu'un ordre passé à un temps $t$ ne soit répercuté dans la série que plus tard.

\indexfrr{finance}{carnet d'ordres}On associe souvent aux données tick by tick les carnets d'ordres~: ce sont les intentions de chaque acteur du marché, elles sont classées par prix croissants pour les intentions de vente et décroissants pour les intentions d'achat. Une donnée souvent mesurée est l'écart entre le prix de vente le plus bas et le prix d'achat le plus haut qu'on appelle \textit{bid-offer spread}.\indexfrr{finance}{bid-offer spread} Cette différence est positive (voir figure~\ref{finance_graph_ohlc_figure_carnet}). Le prix d'une action n'évolue pas de manière continue, il ne peut augmenter ou diminuer que d'une valeur précise appelée \textit{tick}. Fournir des données financières nettoyées est un service qui se vend assez cher et qui sert principalement à l'hyper trading. En agissant suffisamment vite (100~millisecondes pour aller retour bourse-banque-bourse), il est possible de placer un ordre à un prix qui assure son exécution.
    		
    	    
				\begin{figure}[ht]
				\begin{center}\begin{tabular}{|c|}\hline
    		\includegraphics[height=4cm, width=8cm]{\filext{../python_cours_exemple/image/carnet}} \\ \hline
    		\end{tabular}\end{center}
    		\caption{ Exemple de carnet d'ordres, tous les ordres ne sont pas représentés.}
    		\label{finance_graph_ohlc_figure_carnet}
    		\end{figure}
    		    	    
    	    		
\subsubsection{Rendements, Volatilité, Corrélation} \label{finance_rendemnt_annee}
\indexfrr{finance}{rendement}

Le CAC40 a perdu 0.2\% aujourd'hui, -0.2\% est le rendement du CAC40 sur cette journée. Si on définit une série ou quotidienne ou \textit{daily}\indexfrr{finance}{daily} par $(X_t)_t$, le rendement journalier est défini par~:
\begin{eqnarray}
r_t &=& \ln \frac{X_t}{X_{t-1}} \sim \frac{X_t - X_{t-1}}{X_{t-1}} \\
\ln \frac{X_t}{X_{t-2}} &=& \ln \frac{X_t X_{t-1}}{X_{t-1} X_{t-2}} = \ln \frac{X_t}{X_{t-1}} + \ln \frac{X_{t-1}}{X_{t-2}}
                        = r_t + r_{t-1} \nonumber
\end{eqnarray}
%
Les logarithmes se manipulent assez bien puisque un rendement annuel devient la somme des rendements quotidiens. Ce dernier n'est souvent pas très représentatif, on préfère un rendement annualisé. Comme il y a environ $N=220$ jours de trading par an, le rendement annualisé devient~:
\begin{eqnarray}
R^{year} &=& N R^{day}  \Longleftrightarrow R^{day} = \frac{R^{year}}{N}
\end{eqnarray}
%
Un rendement annuel de 10\% correspondant à un rendement journalier moyen de 0,045\%. Un rendement de 10\% par an est un excellent rendement mais il est intéressant de savoir si ce résultat a été obtenu de façon graduelle tout au long de l'année ou si c'était plutôt par à coup. C'est ce que tente de mesurer la volatilité d'une série~: c'est l'écart-type des rendements. \indexfrr{finance}{volatilité}
\begin{eqnarray}
V^{day} &=& \sqrt{ \frac{1}{N} \sum_{t=1}^{N} \pa{r_t^{day} - \overline{r^{day}}}^2 } \\
\text{avec }\overline{r^{day}} &=& \frac{1}{N} \sum_{t=1}^{N} r_t^{day} 
\end{eqnarray}
%
Cette volatilité est quotidienne ou \textit{daily}, là encore, on préfère parler de volatilité annualisée\footnote{Le rendement annuel est la somme des rendements quotidiens, on suppose que ceux-ci sont tous indépendants les uns des autres et identiquement distribués, par conséquent~: $$\sigma^{year} = \sqrt{\esp{(R^{year})^2}} = \sqrt{ \esp{\sum_1^N (R_i^{day})^2}} = \sqrt{ \esp{N(R^{day})^2}} = \sqrt{N} \sigma^{day}$$}~:
\begin{eqnarray}
\sigma^{year} &=& \sqrt{N} \sigma^{day}  \Longleftrightarrow \sigma^{day} = \frac{\sigma^{year}}{\sqrt{N}}
\end{eqnarray}
%

Un dernier indicateur\indexfrr{finance}{corrélation} souvent utilisée est l'indice de corrélation entre deux séries. Lorsqu'on compare deux séries financières issues du même secteur (Société Générale et BNP par exemple), il est fort probable que ces deux séries réagissent de manière similaire à des événements économiques relatifs au secteur bancaire. Pour mesurer la proximité entre ces deux séries, on utilise la corrélation entre rendements~:
\begin{eqnarray}
\rho(R_1,R_2) &=& \frac{1}{N \sigma_1^{day} \sigma_2^{day}} 
				\sum_{i=1}^{N} \pa{ r_{1t}^{day} - \overline{r_{1}^{day}} }
											 \pa{ r_{1}^{day} - \overline{r_{2}^{day}} }
\end{eqnarray}
%
Cet indicateur est compris dans l'intervalle $\cro{-1,1}$. Il est souvent calculé sur la dernière année écoulée, il exprime la proximité de deux séries financières. Investir sur deux actions fortement corrélées revient à investir le double sur une seule des deux puisque les rendements sont sensiblement les mêmes.

Ces indicateurs sont des moyennes, ils peuvent être estimés sur des périodes plus ou moins longues, sur des périodes glissantes mais de par leur nature, ils sont peu sensibles aux variations courtes.


\subsubsection{Moyenne mobile, bandes de Bollinger}
\indexfrr{finance}{moyenne mobile}

La moyenne mobile est un indicateur couramment utilisé car il permet de mieux visualiser la tendance d'une courbe financière en gommant les variations quotidiennes. Cette moyenne est simplement la moyenne des dernières valeurs passées. On définit l'indicateur $MM(n,t)$ à la date~$t$ la moyenne mobile~$n$ par\footnote{MA pour Moving Average en anglais.\indexfrr{finance}{moving average}}~:
\begin{eqnarray}
MM(n,t) = \frac{1}{n}  \summy{i=0}{n-1} X_{t-i}
\end{eqnarray}
%
Cette moyenne est décentrée car elle ne tient compte que des valeurs passées, on dit souvent que la moyenne est en retard par rapport à la série elle-même. Cet indicateur permet de dégager une tendance mais prévoit toujours avec retard un changement de tendance. La figure~\ref{finance_graph_ohlc_figure_trend} représente le cours d'une action à côté de sa moyenne mobile. Cet indicateur est couramment accompagnée des bandes de Bollinger qui enserrent la série financière dans une sorte de tube. On définit tout d'abord la distance moyenne entre la série et sa moyenne~:
\begin{eqnarray}
dist(n,t) = \sqrt{\frac{1}{n} \summy{i=0}{n-1} \pa{X_{t-i} - MM(n,i)}^2}
\end{eqnarray}
%
\indexfrr{finance}{bandes de Bollinger}Les bandes de Bollinger sont définies par l'intervale $\cro{ MM(n,t) - \alpha dist(n,t), \; MM(n,t) + \alpha dist(n,t)}$ où $\alpha$ est un paramètre qui détermine la largeur du couloir. Le fait que la série sorte de ce couloir indique un jour de plus forte variation.

De nombreux autres indicateurs sont utilisés par les traders au cours de leur analyse technique. Le tableau~\ref{finance_table_technique_indicateur} en reprend quelques-uns. On note par $\pa{O_t, H_t, L_t, C_t}$ les quatre prix Open High Low Close pour la période~$t$.

\begin{table}[ht]
\begin{center}\begin{tabular}{|p{3cm}|p{13cm}|} \hline
moyenne mobile exponentielle & C'est une moyenne mobile qui accorde plus de poids aux valeurs récentes. Elle est définie par un paramètre
																$\alpha$~: $MME_{\alpha}(t) = \alpha X_t + (1-\alpha) MME_{\alpha}(t-1)$. 
																Le paramètre $\alpha$ est souvent défini
																comme étant $\alpha = \frac{2}{d+1}$ où $d$ est un nombre de périodes.
																MME = EMA pour Exponential Moving Average en anglais.
																\\ \hline
True Range 					& 	Il est défini par $TR_t = \max\acc{C_{t-1}, H_t} - \min\acc{L_t, C_{t-1}}$. 
												Il donne une estimation différente des variations
						 						opérées par une série financière durant la période. L'indicateur $TR_t$ permet
						 						de prendre en compte la variabilité intra-période (intraday si les périodes sont des jours).
						 						Rapporté à la série elle-même, c'est une mesure semblable à la volatilité mais beaucoup plus 
						 						réactive puisque ce n'est pas une moyenne.
						 						\\ \hline
MACD 								&	  Cet indicateur sert à détecter les changements de tendance en calculant la différence entre deux moyennes 
												mobiles d'horizons différents $n > m$~: $MACD_{m,n}(t) = EMA_m(t) - EMA_n(t)$. Un changement de signe indique 
												un changement de tendance. Pour un trading daily, les horizons sont souvent choisis dans l'ensemble
												$(n,m) \in \acc{9,12,26}^2$. En pratique, l'indicateur utilisé n'est pas directement le MACD mais une 
												moyenne mobile de celui-ci.
												\\ \hline		 						
Parabolic SAR (Stop And Reverse)      	&  Cet indicateur cherche à détecter les tendances, il est défini par~:
												$SAR(t) = SAR(t-1) + \alpha \pa{ EP(t) - SAR(t-1)}$. $\alpha$ est un paramètre en général fixé à~$0,02$
												et qui croît de $0,02$ à chaque changement de tendance jusqu'à la valeur~$0,2$. $EP(t)$ 
												désigne le prix extrême observé
												au cours de la tendance en cours, il correspond à un prix maximal pour un trend haussier et un prix minimal
												pour un trend baissier. Le $SAR$ détermine si le trend est haussier s'il se situe en-dessous du prix actuel, 
												le trend est baissier s'il se situe au-dessus du prix actuel.
												\\ \hline
RSI (Relative Strength Indicator      	& Cet indicateur sert à comparer les forces des mouvements 
												baissiers et haussiers. On définit tout
												d'abord les deux séries $U_t = \max\acc{0,C_t - C_{t-1}}$ et $D_t = \max\acc{0,C_{t-1} - C_t}$. 
												On définit ensuite
												$EMU_n(t)$ et $EMD_n(t)$ comme étant les moyennes mobiles exponentielles des séries $(U_t)$ et $(D_t)$. 
												On définit l'indicateur 
												$RS_n(t) = \frac{EMU_n(t)}{EMD_n(t)}$. Enfin, l'indicateur $RSI_n(t) = 100 - \frac{100}{1+RS_n(t)}$.
												\\ \hline
\end{tabular}\end{center}
\caption{Indicateurs techniques calculés sur une série financière définie par la donnée de $\pa{O_t, H_t, L_t, C_t}$, les prix Open
				High Low Close pour la période~$t$. Les indicateurs liés aux moyennes mobiles sont écrits avec la syntaxe française
				MM = moyenne mobile, en anglais, le terme approprié est MA = moving average, EMA = exponential moving average.}
\label{finance_table_technique_indicateur}			
\indexfrr{finance}{True Range}
\indexfrr{finance}{moyenne mobile exponentielle}
\indexfrr{finance}{moving average}
\indexfrr{finance}{MACD}
\indexfrr{finance}{RSI}
\end{table}



\subsubsection{Achats, ventes, levier}

Il n'est pas nécessaire de posséder une action pour la vendre. Au sein d'une banque ou d'un Hedge Fund, il est possible de vendre une action puis la racheter (on peut emprunter l'action au broker). Néanmoins, la régulation de certains pays interdit la vente à découvert.\indexfrr{finance}{vente à découvert} Ce système permet d'"attraper" les tendances baissières. Il suffit de vendre au moment où la baisse commence puis d'acheter lorsque celle-ci s'arrête.
\indexfrr{finance}{levier}

Un terme revient fréquement lorsqu'on parle de finance, il s'agit du \textit{levier}. A priori, avec un fond de 100, il est possible d'acheter pour 100 d'actions. En empruntant 100 de plus, il est alors possible d'acheter pour 200 d'actions. On dit que le levier est de 200\% ou que la stratégie est \textit{leveragée}\footnote{anglicisme couramment utilisé pour désigner un fort levier} deux fois. Cette pratique est particulièrement intéressante lorsque la performance du Hedge Fund est bien supérieure au taux de l'emprunt. Ces sociétés ont pris beaucoup d'essort entre 2001 et 2007, favorisés par la politique de taux bas (2\%) pratiqués par Banque Fédérale Américaine.\indexfrr{finance}{FED} Le danger apparaît en temps de crise, un fort levier implique des pertes possibles beaucoup plus grandes. Le livre \citeindex{Jacquillat2008} ouvre une discussion quant à la responsabilité des Hedge Funds durant la crise des subprimes.

\subsubsection{Hedge Funds}
\indexfrr{finance}{Hedge Funds}\indexfrr{finance}{subprime}\indexfrr{finance}{gestion alternative}
Accusés de biens des maux lors de la crise des subprimes, les Hedge Funds propose ce qu'on appelle une gestion alternative de fonds. Ils proposent des rendements en moyenne de 10\% par an avec une part de risque un peu plus importante. Majoritairement basés aux Iles Cayman et aux Etats-Unis (voir table~\ref{hedge_funs_table_repartition}), ils favorisent des placements à très courts termes (quelques mois) et sont fortement \textit{leveragés}. 

\begin{table}[ht]
\begin{center}\begin{tabular}{cc}
\begin{minipage}{7cm}
\begin{center}\begin{tabular}{|l|r|} \hline
Iles Cayman & 34 \% \\ 
USA 				& 20 \% \\ 
British Virgin Islands & 14 \% \\ 
Bermudes & 5 \% \\ 
Luxembourg & 5 \% \\ 
France & 4 \% \\ 
Irlande & 3 \% \\ 
Bahamas & 3 \% \\
Guernsey & 2 \% \\
Antilles Néerlandaises & 2 \% \\ \hline
\end{tabular}\end{center}
\end{minipage} 
&
\begin{minipage}{7cm}
\begin{center}\begin{tabular}{|l|r|} \hline
Multi-stratégie & 31 \% \\
Long / Short Equity & 23 \% \\
Event Driven & 13 \% \\
Commodity Trading Advisor (CTA) & 6 \% \\
Fixed Income Arbitrage & 5 \% \\
Emerging Markets & 4 \% \\
Global Macro & 4 \% \\
Equity Market Neutral & 4 \% \\ \hline
\end{tabular}\end{center}
\end{minipage} 
\end{tabular}\end{center}
\caption{Implantation des Hedge Funds de par le monde et répartition selon les différentes stratégies de trading. 
Source \textit{Lipper} Mars 2007, extrait de \cite{Jacquillat2008}.}
\label{hedge_funs_table_repartition}
\end{table}

La table~\ref{hedge_funs_table_repartition} présente également différentes stratégies utilisés par les Hedge Funds. Parmi ces fonds, 31\% sont multi-stratégies~: ce sont des fonds de fonds, des Hedge Funds qui investissent dans d'autres fonds. La description des autres stratégies s'appuie sur le livre~\citeindex{RocchiChristiaens2007}.

La stratégie \textbf{Long / Short Equity}\indexfrrr{finance}{stratégie}{Long / Short Equity} regroupe les stratégies qui prennent des positions à la fois vendeuses et acheteuses sur des actions. Le pair trading (voir paragraphe~\ref{pair_trading_paragraph}) est d'ailleurs l'une d'entre elles. Les prises de positions peuvent s'étendre sur différents secteurs économiques. Pour éviter une trop grande exposition et réduire les risques de pertes, les gérants font parfois en sorte que la somme des positions acheteuses soit équivalente à celle des positions vendeuses pour chaque secteur. Ce cas particulier s'appelle \textbf{Equity Market Neutral}.\indexfrrr{finance}{stratégie}{Equity Market Neutral}

La stratégie \textbf{Event Driven}\indexfrrr{finance}{stratégie}{Event Driven} se focalise sur les sociétés dont l'actualité est mouvementée avec un fort impact sur le cours de ses actions. Les gérants de ce type de fonds essayent d'anticiper des événements ayant trait à une société particulière comme une fusion ou une acquisition, une offre publique d'achat (OPA). L'annonce des retards de livraison de l'avion A380 rentre dans cette catégorie. La réussite nécessite une bonne connaissance de l'histoire des sociétés dont on souhaite acheter ou vendre les actions, de se pencher sur leur bilan financier.

La stratégie \textbf{Commodity Trading Advisor} ou tout simplement \textbf{CTA}\indexfrrr{finance}{stratégie}{Commodity Trading Advisor}\indexfrrr{finance}{stratégie}{CTA} s'applique à des produits Futures comme les Futures sur les matières premières ou \textit{Commodities}.\indexfrr{finance}{sous-jacent}\indexfrr{finance}{Future}\indexfrr{finance}{commodity} C'est le domaine de prédilection des fonds systématiques qui utilisent des algorithmes de trading automatique (voir paragraphe~\ref{parar_strat_auto_famille}). Les Futures sont des produits très liquides qui concernent aussi bien le pétrole que le blé ou l'or, les indices comme le CAC40. Un Future est la promesse d'échanger un produit à une date donnée appelée \textit{maturité}.\indexfrr{finance}{maturité} Par exemple, le \textit{Brent Crude Oil}\indexfrr{finance}{Brent Crude Oil} côté sur le \textit{New-York Merchantile Exchange (NYMEX)}\indexfrr{finance}{NYMEX}\indexfrr{finance}{New-York Merchantile Exchange} est un produit Future dont il existe une maturité par mois. Le café n'est échangé que tous les trois mois. Lorsqu'un Hedge Fund achète un Future Brent Crude Oil Aug08, il prend l'engagement d'acheter du pétrole à la fin du mois d'août~2008, il ne paiera qu'à cette date\footnote{Cette affirmation n'est pas complètement vraie, pour éviter qu'un investisseur ne fasse défaut, il est tenu de verser une somme forfaitaire (un appel de marge) à la chambre des compensations, il doit compléter cette somme dès que le prix du Future s'écarte par paliers du prix initial.}. Les Hedge Funds n'achètent bien entendu jamais de pétrole, lorsque la fin du mois d'août arrive, ils vendent ce produit pour acheter celui correspondant à la maturité suivante (en anglais \textit{roll}).\indexfrr{finance}{roll} Avec ce système, il n'y a pas besoin d'emprunter, une position vendeuse est aussi facile à prendre qu'une position acheteuse puisque rien n'est échangé avant la date de maturité.

La stratégie \textbf{Fixed Income Arbitrage}\indexfrrr{finance}{stratégie}{Fixed Income Arbitrage} concerne les taux d'intérêt. Lorsque l'argent est prêté, le taux d'intérêt dépend de la durée. Cette stratégie consiste à jouer avec ces taux, à parier sur leur évolution.

Le terme \textbf{Emerging Markets}\indexfrrr{finance}{stratégie}{Emerging Markets} désigne des stratégies qui prennent positions sur des marchés émergents, des économies émergents comme celle du Brésil ou de la Chine. Ces économies affichent de forts taux de croissance dont les Hedge Funds espèrent profiter.

La stratégie \textbf{Global Macro}\indexfrrr{finance}{stratégie}{Global Macro} nécessite d'excellentes connaissances en économie car il s'agit de prendre des paris sur l'évolution à court terme de l'économie mondiale. Anticiper la hausse du prix du pétrole en fait partie, comme parier sur l'évolution des taux d'intérêts américains et européens ou prévoir la croissance de l'ensemble d'un secteur économique.

Le terme \textit{Hedge} signifie se couvrir,\indexfrr{finance}{hedge} se couvrir contre un pari trop risqué comme prendre des positions inversées sur des produits similaires, acheter ou vendre des options\footnote{Une option est un produit financier qui permet d'assurer l'acheteur de cette option contre une variation des prix. L'acheteur d'une option achète le droit d'acheter ou de vendre une action à un prix donné et à une date donnée. L'acheteur peut ou non exercer son droit d'acheter ou de vendre. Par exemple, un acteur achète une option qui lui confère le droit d'acheter dans un mois une action à 110 euros sachant qu'elle est à 100 aujourd'hui. Si au bout d'un mois, l'action est à 120, l'acheteur exercera son option, son bénéfice sera de 10 moins le prix de l'option, dans le cas contraire, il n'exercera pas son option, il ne paiera que le prix de l'option. Les termes \textit{call} et \textit{put} sont couramment utilisés pour désigner les options.\indexfrr{finance}{put}\indexfrr{finance}{call} Un call est le droit d'acheter, un put est le droit de vendre.}.\indexfrr{finance}{option}

Les investisseurs qui souhaitent investir dans un Hedge Funds regardent son \textit{track record}\indexfrr{finance}{track record} qui désigne sa performance passée, sa capacité à afficher des rendements positifs chaque année, synonyme d'une bonne gestion. L'investisseur regarde aussi la volatilité de la performance, lorsqu'elle est élevée, l'incertitude sur la performance est plus grande. L'investisseur regarde également la corrélation avec le marché, le Hedge Funds est un placement risqué, une bonne gestion signifie aussi une volatilité contenue et une absence de corrélation avec le marché afin d'être moins sensible aux crises du marché.



\subsection{Familles de stratégies} \label{parar_strat_auto_famille}

Les paragraphes qui suivent présentent différentes stratégies qui cherchent à capter chacune un aspect particulier d'une série financière. Ces stratégies s'appuient principalement sur des informations numériques calculées à partir des données numériques elles-mêmes (Open High Low Close Volume). Une exception pourtant~: les stratégies de type \textit{style} s'appliquent aux actions et utilisent d'autres informations relatives à la société émettrice de ses actions comme le chiffre d'affaire et tout autre chiffre extrait de leur bilan financier. 

Il n'existe pas de meilleures stratégies, il est rare qu'une stratégie soit efficace sur tous les secteurs économique ou sur tous les types de produits, action, pétrole, indices, taux, ... Il est rare qu'une stratégie soit tout le temps performante, il est toujours préférable de constuire un système en utilisant plusieurs, la volatilité est moins élevée.

Il n'est pas simple d'intégrer dans des systèmes automatiques des informations quantitatives relatives aux informations économiques comme l'annonce d'un plan de licenciement, des retards dans les livraisons d'avions, une nouvelle dépréciations d'actifs. Outre la complexité qu'entraînerait la prise en compte des telles informations, un argument qui justifie la seule utilisation de l'analyse technique est l'efficience des marchés~: les nouvelles économiques sont prises en compte par les prix eux-mêmes qui sont la résultante des ordres passés sur le marché. Les marchés financiers corrigent d'eux-mêmes les prix car ils intègrent toute l'information connue.

\indexfrr{finance}{analyse technique}
Une stratégie s'intéresse avant tout à un comportement moyen. Une moyenne mobile ne peut pas prendre en compte un jour de trading aberrant, une journée de crise, une stratégie cherche avant tout à profiter d'un comportement récurrent d'une série telle qu'une tendance et doit faire l'impasse sur des comportements erratiques et passagers. Ces derniers ne sont pas assez fréquents pour être étudiés, ils sont à chaque fois différents et leur compréhension dépasse le cadre de l'analyse technique.


\subsubsection{Trend Following}  \label{section_trend_following_s}
\indexfrr{finance}{trend following}
Le \textit{Trend Following} consiste à suivre une tendance qu'elle soit haussière ou baissière. Une simple stratégie de Trend Following est illustrée par la figure~\ref{finance_graph_ohlc_figure_trend}. Ce type de stratégie parie sur le long terme, le temps nécessaire pour qu'une tendance se forme et dure. On parle parfois d'attraper une tendance~: la stratégie prend plusieurs fois de mauvaises décisions et décide de couper sa position\footnote{On parle de position ou pose pour une quantité négative ou positive d'actions. Couper sa pose consiste à annuler sa position~: tout vendre si on possédait des actions ou tout acheter si la position était négative. Après avoir coupé sa position, le portefeuille n'est plus constitué que d'argent.} peu de temps après, de temps en temps, la décision est bonne et la pose est gardée le plus longtemps possible, jusqu'à ce que la tendance prenne fin.


				\begin{figure}[ht]
				\begin{center}\begin{tabular}{|c|}\hline
    		\includegraphics[height=5cm, width=12cm]{\filext{../python_cours_exemple/image/trend}} \\ \hline
    		\end{tabular}\end{center}
    		\caption{Cours de l'action \textit{BNP} accompagné par sa moyenne mobile 50 et ses bandes de Bollinger. Une stratégie simple de 
    						 trend following consiste à acheter lorsque le cours dépasse sa bande 
    						 supérieure de Bollinger (point~A) et à revendre lorsque
    						 le cours passe sa bande inférieure (point~B). 
    						 Le gain est alors la différence des cours d'achat et de vente. Lorsque la tendance 
    						 est baissière, il suffit de vendre d'abord puis d'acheter ensuite.
    						 }
    		\label{finance_graph_ohlc_figure_trend}
    		\end{figure}

Cette stratégie prend une position acheteuse ou \textit{long} lorsque la tendance est haussière et vendeuse ou \textit{short} lorsque la tendance est baissière.\indexfrr{finance}{long}\indexfrr{finance}{short} Ce type de stratégie est averse au changement de tendance qu'elle détecte avec retard, car cette stratégie ne s'appuie que sur des moyennes mobiles. Plus généralement, lorsque la volatilité est grande, ce type de stratégie est déconseillée, il est préférable d'utiliser le \textit{Mean Reversing}.    

Concevoir un indicateur de tendance n'est pas chose facile. Même si l'\oe il humain est habitué à analyser des courbes financières, il n'en est pas de même pour un algorithme qui fait face aux effets de seuil. La stratégie décrite par la figure~\ref{finance_graph_ohlc_figure_trend} prend des décisions lorsque sa courbe touche une de ses bandes de Bollinger. Un expert humain pourra prendre une décision si la distance entre la courbe et la bande est petite visuellement, un ordinateur a besoin de seuils constants pour prendre sa décision qui est binaire. On pourrait modifier la largeur de la bande de Bollinger mais la stratégie est souvent très sensible à cette largeur. Ce point sera évoqué plus loin au paragraphe~\ref{analyse_finace_strategie}.

Un autre facteur est la longueur de la tendance. La stratégie toujours décrite par la figure~\ref{analyse_finace_strategie} s'appuie sur une moyenne mobile de 50 jours. Elle détecte bien les tendances dont la longueur se situe autour de cette valeur mais elle est susceptible de prendre de mauvaises valeurs si la tendance est plus courte ou si une trentaine de jours assez volatiles s'immiscent au sein d'une tendance longue de plusieurs mois.

En pratique, la stratégie est munie de quelques mécanismes qui permettent de limiter les pertes. Lorsque la stratégie achète une action à un prix~$p$, si le prix descend en dessous d'un seuil égal à $p (1-\epsilon)$ alors la position est coupée. La position est coupée si le prix passe au-dessus du seuil $p(1+\epsilon)$ dans le cas d'une position vendeuse. Ce système permet de limiter les pertes de la stratégie, il est souvent présent dans les stratégies qui suivent avec le même objectif~: réduire le risque. Les marchés ont d'ailleurs intégrer ces mécanismes avec les \textit{stop order}.\indexfrr{finance}{stop order} Ce n'est plus le trader qui coupe sa pose mais la bourse elle-même.

Cette règle peut encore être améliorée lorsque la stratégie est gagnante depuis un certain temps, cette règle propose de stopper la stratégie à un niveau loin de son niveau actuel. Dans ce cas, on rapproche de temps en temps le niveau auquel la position est coupée pour éviter des pertes trop importantes. On rapproche le niveau de stop. Dans le même ordre d'idée, on peut décider de couper sa pose parfois lorsque la courbe s'éloigne beaucoup de sa moyenne mobile et que la position est gagnante~: c'est prendre ses profits avant que ceux-ci ne diminuent.
    		

\subsubsection{Mean Reversing}
\indexfrr{finance}{Mean Reversing}
Cette stratégie s'intéresse aux périodes durant lesquelles la volatilité est élevée et où aucune tendance ne se dégage. Cela suppose que le cours de l'action va osciller autour d'une position d'équilibre et que la meilleure stratégie à suivre est d'acheter lorsque le cours vient de baisser et de vendre lorsque le cours vient de monter.

En terme de décision, cette stratégie prend beaucoup de poses, les garde peu de temps et celles-ci sont souvent gagnantes. La stratégie commence à perdre lorsque la période de haute volatilité laisse place à une nouvelle tendance. Cette situation est mal gérée par cette stratégie qui se retrouve avec une position inverse à celle qu'elle aurait dû prendre. La figure~\ref{finance_graph_ohlc_figure_meanr} illustre ce principe.


				\begin{figure}[ht]
				\begin{center}\begin{tabular}{|c|}\hline
    		\includegraphics[height=5cm, width=12cm]{\filext{../python_cours_exemple/image/meanr}} \\ \hline
    		\end{tabular}\end{center}
    		\caption{Cours de l'action \textit{BNP} accompagné par sa moyenne mobile 50 et ses bandes de Bollinger. 
    						 Une stratégie simple de 
    						 mean reversing consiste à acheter lorsque le cours dépasse sa bande inférieure de Bollinger (point~A) 
    						 et à revendre lorsque
    						 le cours revient vers sa borne supérieure (point~B). 
    						 Le gain est alors la différence des cours d'achat et de vente.
    						 }
    		\label{finance_graph_ohlc_figure_meanr}
    		\end{figure}
    		
\indexfrr{finance}{Contrarian}    		
Le terme \textit{Contrarian} apparaît parfois pour désigner cette stratégie. Ce terme désigne une stratégie dont les positions prises sont inverses au consensus suivi par le marché. Toutefois, la stratégie est souvent munie d'un mécanisme limitant les pertes tel que celui décrit au paragraphe~\ref{section_trend_following_s}.



\subsubsection{Pair Trading}\label{pair_trading_paragraph}
\indexfrr{finance}{pair trading}

Le pair trading consiste à construire un portefeuille de deux actions. On étudie dans ce cas la série du rapport des prix des deux actions. On choisit le plus souvent deux actions appartenant au même secteur économique (BNP, Société Générale par exemple) de façon à obtenir une série moins sensible aux événements économiques. En cas de crise ou de rebond du secteur, les deux actions sont toutes deux susceptibles d'être atteintes, le rapport des prix ne dépend plus que des différences des deux sociétés. Ce procédé permet de construire une série moins sensible aux tendances qui s'appliquent à un secteur dans son ensemble (voir figure~\ref{finance_graph_ohlc_figure_pair}).

Les stratégies appliquées à ce rapport de prix sont plutôt de type mean reversing, on s'attend à ce que temporairement le rapport des prix s'écarte de sa moyenne puis y reviennent. La différence intervient lors de la prise de décision, au lieu d'acheter ou de vendre une action, prendre une position consiste à acheter une action et vendre l'autre, quitter la position revient à effectuer la manipulation inverse.



				\begin{figure}[ht]
				\begin{center}\begin{tabular}{|c|}\hline
    		\includegraphics[height=8cm, width=12cm]{\filext{../python_cours_exemple/image/pair}} \\ \hline
    		\end{tabular}\end{center}
    		\caption{Rapport entre l'action Société Générale et l'action BNP. 
    						 On observe une croissance supérieure pour la Société Générale jusqu'en 
    						 août 2007 date du début de la crise des subprimes puis une nette dégradation 
    						 depuis l'affaire Kerviel en janvier 2008. Auparavant,
    						 la série du rapport paraît plus stable et il semble plus judicieux de faire du mean reversing.}
    		\label{finance_graph_ohlc_figure_pair}
    		\end{figure}



\subsubsection{Styles, Value, Growth}

\indexfrr{finance}{style}\indexfrr{finance}{value}\indexfrr{finance}{growth}

Le pair trading permet de prendre des paris sur une paires d'actions, une stratégie construite à partir de style propose une façon de jouer simultanément avec beaucoup d'actions. Elle utilise des indicateurs qui décrivent la santé financière d'une entreprise, ils sont généralement calculés à partir des bilans financiers que les sociétés cotées sont obligées de produire régulièrement. On distingue souvent deux classes de stratégies, les \textit{growth}\footnote{croissance} et les \textit{value}\footnote{valeur}. Les indicateurs servent à estimer si pour une compagnie, il est préférable de suivre une stratégie plutôt \textit{growth} ou plutôt \textit{value}.

Une société "\textit{growth}" affiche un fort taux de croissance. Le prix de l'action est élevé mais les perspectives de croissance suggère une hausse. Il est intéressant dans ce cas d'acheter le stock. Une société "\textit{value}" est plutôt estimée à son juste prix et les perspectives de hausse de cours de l'action sont faibles, il dans ce cas préférable d'attendre une baisse du cours avant d'acheter.

Le tableau~\ref{indicateur_style_example} regroupe quelques indicateurs très utilisés pour étudier les sociétés cotées en bourse. Il existe plus d'une centaine d'indicateurs que les acteurs des marchés financiers suivent. Pour chacun d'entre eux, il faut savoir ce qu'est une bonne valeur, une mauvaise, quelle décision (acheter ou vendre) il faut prendre lorsque l'indicateur est élevé.

\begin{table}[ht]
\begin{center}\begin{tabular}{|p{10cm}|p{6cm}|}\hline
Earnings before Interest, Taxes, Depreciation, and Amortization (EBITDA) & 
								revenus avant Intérêts, impôts (Taxes), Dotations aux Amortissements et provisions \\ \hline
$\mbox{Earnings Per Share (EPS)} = \frac{\mbox{Net Earnings}}{\mbox{Outstanding Shares}}$ & 
								c'est le bénéfice d'une entreprise rapporté aux nombres de parts ou d'action \\ \hline
$\mbox{Price to Sales (P/S)} = \frac{\mbox{Market Cap}}{\mbox{Revenues}}$ & 
								Capitalisation boursière rapportée au chiffre d'affaires \\ \hline
$\mbox{Dividend Payout Ratio (DPR)} = \frac{\mbox{Dividends Per Share}}{\mbox{EPS}}$ & 
								Dividende d'une action divisé par EPS \\ \hline
\begin{tabular}{l}$\mbox{Price to Earnings Ratio (P/E)} = \frac{\mbox{Stock Price}}{\mbox{EPS}}$ \\
								ou $\mbox{P/E ratio}=\frac{\mbox{Price per Share}}{\mbox{Annual Earnings per Share}}$ \end{tabular} & 
								Prix d'une action divisé par EPS ou aussi le prix d'une action divisé par le dividende \\ \hline
\end{tabular}\end{center}
\caption{Quelques indicateurs relatifs aux sociétés.}
\label{indicateur_style_example}
\indexfrrr{finance}{indicateur}{P/E}
\indexfrrr{finance}{indicateur}{DPR}
\indexfrrr{finance}{indicateur}{EPS}
\indexfrrr{finance}{indicateur}{P/S}
\indexfrrr{finance}{indicateur}{EBIDTA}
\end{table}

Un indice P/E élevé indique un petit dividende comparé au prix de l'action, il est donc préférable de ne pas acheter. Il n'est pas toujours facile de savoir ce qu'est une valeur intéressante pour un indicateur mais on peut supposer que pour un secteur économique donné, il existe au moins une société dont l'indicateur est intéressant. A la date $t$, en classant par ordre croissant tous les indicateurs d'un même secteur économique, on peut supposer que les indicateurs extrêmes correspondent à des sociétés intéressantes.

Par exemple, supposons qu'au début de chaque mois, c'est à dire à la date~$t$, on dispose d'une nouvelle valeur de l'indicateur $I_t^i$ pour la société~$i$. On les trie par ordre croissant~:  $I_t^{\sigma(1)} \infegal I_t^{\sigma(2)} \infegal ... \infegal I_t^{\sigma(N)}$. Pour cet indicateur, une petite valeur suggère une position acheteuse. Par conséquent, on va prendre une position acheteuse pour les premiers 10\% et une position vendeuse pour les derniers 10\%.
%
\begin{footnotesize}\begin{center}\begin{tabular}{|l|l|} \hline
\textbf{société} & \textbf{position} \\ \hline
$\sigma(1)$   	& acheteuse \\     
...  			   		& acheteuse \\     
$\sigma(10)$  	& acheteuse \\     
$\sigma(11)$  	& - \\     
...					  	& - \\     
$\sigma(N-11)$  & -\\     
$\sigma(N-10)$  & vendeuse \\     
...		  			  & vendeuse \\     
$\sigma(N)$     & vendeuse \\     \hline
\end{tabular}\end{center}\end{footnotesize}
%
Le mois d'après, le classement a changé, quatre cas sont possibles~:
\begin{enumerate}
\item La société reçoit un classement équivalent et sa position ne change pas.
\item La société n'apparaît plus dans les extrémités du classement, sa position est coupée.
\item La société apparaît dans les extrémités du classement, on prend une position.
\item La société passe d'une extrémité à une autre, on retourne la position.
\end{enumerate}
%
Cette étape qui consiste tous les mois à conserver, couper, prendre ou retourner une position est souvent appelée \textit{rebalancing}.\indexfrr{finance}{rebalancing} Il est préférable de n'utiliser cette méthode que sur des sociétés appartenant au même secteur économique, dans le cas contraire, classer les indicateurs par ordre croissant peut ne pas être pertinent.

\indexfrrr{finance}{indicateur}{combinaison}
Ce type de stratégie suppose le choix d'un indicateur ou d'une combinaison d'indicateurs. Le choix est souvent guidé par des raisons économiques et aussi l'utilisation de backtest\footnote{voir paragraphe~\ref{analyse_finace_strategie}, page~\pageref{analyse_finace_strategie}} pour déterminer un bon indicateur. En ce qui concerne leur combinaison, elle n'est pas toujours facile. Tout d'abord, il faut faire attention au sens de chaque indicateur~: un P/E faible suggère une position acheteuse, un DPR élevé suggère aussi une position acheteuse. Il est aussi difficile de combiner linéairement des indicateurs qui ont des ordres de grandeur différents. Une combinaison simple qui contourne ce problème est de combiner le rang des sociétés obtenus en les classant selon chaque indicateur de la combinaison. Par exemple, on classe les sociétés selon $-P/E$ et $DPR$, les rangs obtenus sont additionnés et c'est le rang final qui servira à sélectionner les sociétés.





\subsubsection{Gestion de portefeuille}\label{finance_portefeuille_build}
\indexfrr{finance}{gestion de portefeuille}\indexfrr{finance}{portefeuille}\indexfrr{finance}{Markowitz}

Un nom est incontestablement associé à ce thème qu'est la gestion de portefeuille, c'est l'économiste Harry Markowitz qui reçu le prix Nobel d'économie pour ses travaux en 1990. L'idée repose sur la construction d'un portefeuille d'action qui permet d'obtenir un rendement donné avec un risque moindre comparé à celui de chaque action prise séparément.

Chaque action est ici décrit par son rendement moyen $R_i$ et sa volatilité $\sigma_i$. Construire un portefeuille consiste à répartir son argent entre les différents actifs financiers. On affecte un poids~$\alpha_i$ à chaque action~$i$. La somme des poids vérifie les contraintes suivantes~:
%
\begin{eqnarray}
\summy{i=1}{N} \alpha_i = 1 && \\
\forall i \in \ensemble{1}{N}, \; 0 \infegal \alpha_i \infegal 1 
\end{eqnarray}
%
Le rendement moyen du portefeuille est défini par~:
\begin{eqnarray}
R\vecteur{\alpha_1}{\alpha_N} &=& \summy{i=1}{N} \alpha_i R_i
\end{eqnarray}
%
Si on note $\rho_{ij}$ la corrélation entre les deux actions~$i$ et~$j$, le risque ou la volatilité du portefeuille est définie par~:
\begin{eqnarray}
\sigma\vecteur{\alpha_1}{\alpha_N} &=& \sqrt{ \summyone{i,j} \alpha_i \alpha_j \sigma_i \sigma_j \rho_{ij} }
\end{eqnarray}
%
Si on note $\Sigma$ la matrice des covariances des sous-jacents et $X$ les poids du portefeuille ($X'$ sa transposée),  la variance du portefeuille s'exprime~:
\begin{eqnarray}
\sigma^2 \vecteur{\alpha_1}{\alpha_N} &=&  X' \Sigma X
\end{eqnarray}

La construction du portefeuille optimal passe par l'optimisation sous contrainte d'un des deux problèmes suivant~:
\begin{center}\begin{tabular}{cc}
\begin{minipage}{7cm}
$\begin{array}{|ll}
& \underset{\vecteur{\alpha_1}{\alpha_n}}{\min}  \sigma\vecteur{\alpha_1}{\alpha_N}  \\ \\
\text{avec} & R\vecteur{\alpha_1}{\alpha_N} \supegal R_{min} \\
& \sum_{i=1}^{N} \alpha_i = 1 \\
& \forall i, \; 0 \infegal \alpha_i \infegal 1 
\end{array}$
\end{minipage}
&
\begin{minipage}{7cm}
$\begin{array}{|ll}
& \underset{\vecteur{\alpha_1}{\alpha_n}}{\max}  R\vecteur{\alpha_1}{\alpha_N} \\ \\
\text{avec} & \sigma\vecteur{\alpha_1}{\alpha_N}  \infegal \sigma_{max} \\
& \sum_{i=1}^{N} \alpha_i = 1 \\
& \forall i, \; 0 \infegal \alpha_i \infegal 1 
\end{array}$
\end{minipage}
\end{tabular}\end{center}

Lorsque les exigences sur le rendement minimal $R_{min}$ ou la volatilité maximale $\sigma_{max}$ ne sont pas trop fortes, la solution mène à des poids situés dans l'intervalle $\left ] 0,1 \right [$. Il se peut qu'il n'y ait pas de solution, dans ce cas, il faudra assouplir la contrainte sur le rendement minimal ou la volatilité maximale. Dans tous les cas, ces problèmes se résolvent grâce à la méthode des multiplicateurs de Lagrange. Ce problème est un problème d'optimisation convexe avec des contraintes convexes. Il existe d'autres méthodes de résolution comme la programmation
séquentielle quadratique\indexfr{programmation séquentielle quadratique}, l'algorithme du gradient projeté avec contraintes d'inéglité, \indexfr{gradient projeté}\indexfr{Lagrange, multiplicateurs} ou plus récemment Stephen Boyd avec les ADMM\indexfr{ADMM} (\citeindex{Boyd2012})\footnote{voir également \httpstyle{http://www.stanford.edu/\~boyd/papers/pdf/admm\_talk.pdf} et le logiciel CVXGEN \httpstyle{http://cvxgen.com/index.html}.}.

\begin{xremark}{portefeuille d'actions, position vendeuse}
Si les positions vendeuses sont acceptées alors la contrainte sur les poids devient $\forall i, \; -1 \infegal \alpha_i \infegal 1 $. Pour une stratégie \textit{Equity Market Neutral}\indexfrrr{finance}{stratégie}{Equity Market Neutral}, on ajoute une contrainte supplémentaire qui correspond à l'exigence d'avoir autant de positions vendeuses qu'acheteuses~: $\sum_{i=1}^{N} \alpha_i p_i = 0$ où $p_i$ est le prix de chaque actif.
\end{xremark}

\begin{xremark}{portefeuille d'actions, de stratégies}
On a supposé que le portefeuille était un portefeuille d'actions mais dans la mesure où ce dernier est défini par un ensemble de poids affectés à des objets décrits par leur rendement et leur variance, on pourrait tout à fait imaginer que ces objets sont des stratégies. La méthode de Markowitz reviendrait à répartir intelligemment son argent entre les différentes stratégies de trading.
\end{xremark}



\subsubsection{Horizon de trading, intraday, daily}

Il ne paraît pas plus compliqué d'appliquer ces stratégies au trading intraday qu'au trading daily. Dans le second cas, les positions sont tenues plusieurs jours, plusieurs mois et on s'intéresse peu aux variations dans une même journée. Dans le premier cas, on s'intéresse plus particulièrement aux variations qui ont lieu dans une même journée et qui peuvent être importantes. Le prix de clôture peut être équivalent au prix d'ouverture alors que les prix ont montré des variations de 1\% ou 2\% au cours de la journée.

Les séries financières, les indicateurs s'expriment de la même façon que la période soit de un jour ou de cinq minutes. En pratique, certaines contraintes font que le trading intraday est plus complexe à mettre en \oe uvre. Le premier obstacle est informatique~: stocker des prix toutes les cinq minutes est autrement plus coûteux que de stocker un prix par jour. Les temps de calcul sont également plus longs. Pour des données tick by tick, il vaut mieux être épaulé par un informaticien chevronné. Le second obstacle est statistique~: il faut contrôler les données en trading intraday. Il n'est pas rare de manquer de données pendant 15 minutes puis d'obtenir des volumes de transactions quatre fois plus important pour les cinq minutes suivantes. Ceci est illustré par l'exemple suivant~:
%
\indexexemples{OHLC}{}
\begin{verbatimx}
date time         Open    High    Low     Close   Volume
07/11/2007 19:42  7822    7823    7818    7819.5  1130
07/11/2007 19:48  7819.5  7830    7819.5  7822.5  1543
07/11/2007 19:54  7823    7827.5  7819.5  7824    1244
07/11/2007 20:00  7824    7825.5  7822.5  7824.5   216      # 20.00
07/11/2007 20:24  7828    7833    7825.5  7830     640      # 20.24, il manque 3 périodes
07/11/2007 20:30  7829.5  7831.5  7827    7829.5   478
07/11/2007 20:36  7830    7830.5  7821    7829     716
07/11/2007 20:42  7829.5  7834.5  7826    7828     681
\end{verbatimx}
%
A l'inverse, il peut arriver qu'aucun ordre n'ait été passé pendant cinq minutes, au tout début de l'ouverture  d'un marché, ou durant la nuit sur un marché ouvert 24h/24. Dans ce cas, le volume sera nul et les prix immobiles. 

Les périodes d'ouverture et de fermeture des marchés ne sont pas les mêmes d'une année sur l'autre, les bourses ont tendance à rester ouverte de plus en plus tard au fur et à mesure qu'elles s'informatisent. Il faut en tenir compte dans les historiques de données.


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\subsection{Analyse d'une stratégie}\label{analyse_finace_strategie}

Cette partie décrit les principales étapes de la mise au point d'une stratégie automatique. Elle sera illustrée avec une stratégie appliquée sur le cours de la BNP (voir figure~\ref{finance_graph_ohlc_bnp}) de début 2003 à mi-2008. C'est une stratégie Trend Following fonctionnant avec trois paramètres\footnote{Cette stratégie a été implémentée en \pythons et le code est disponible aux adresses suivantes~:

\begin{tabular}{l} 
\httpstyle{http://www.xavierdupre.fr/hal\_python/hal\_python\_help\_html/sample\_test\_python\_timeseries\_ohlc\_correlation.html} \\
\httpstyle{http://www.xavierdupre.fr/hal\_python/hal\_python\_help\_html/sample\_test\_python\_strategy.html} \\
\httpstyle{http://www.xavierdupre.fr/hal\_python/hal\_python\_help\_html/sample\_test\_python\_strategy\_analyse.html} \\
\httpstyle{http://www.xavierdupre.fr/hal\_python/hal\_python\_help\_html/index.html} \end{tabular}

La dernière adresse est celle du module \indexmoduleext{HalPython} avec lequel les trois programmes qui précèdent fonctionnent.}~:
\begin{enumerate}
\item La longueur $d$ de la moyenne mobile, par défaut $d =200$ jours.
\item La largeur $\alpha$ des bande de Bollinger, par défaut $\alpha = 1$ * la distance moyenne sur 200 jours du prix Close à sa moyenne mobile.
\item Lorsque la stratégie a pris une position acheteuse au prix~$p$, si le prix redescend en deça de $p (1-\beta)$, la position est coupée. A l'opposé, si la stratégie prend une position vendeuse, si le prix monte au-dessus de $p (1+\beta)$, la position est également coupée. Par défaut, $\beta = 0.05$.
\end{enumerate}
%
La stratégie est définie par trois règles~:
\begin{enumerate}
\item La première règle définit l'ouverture d'une position lorsque la position est nulle. Si le cours d'une action dépasse la bande de Bollinger supérieure, la stratégie entre en position acheteuse, si le cours dépasse la bande de Bollinger inférieure, la stratégie entre en position vendeuse.
\item La seconde règle est appliquée lorsque le cours franchit à nouveau ses bandes de Bollinger alors que la position n'est plus nulle. Si le cours franchit la bande de Bollinger supérieure et que la position est vendeuse, celle-ci est coupée. Si le cours franchit la bande de Bollinger inférieure et que la position est acheteuse, la position est aussi coupée.
\item La troisième règle est destinée à limiter les pertes, si la stratégie a ouvert une position acheteuse au prix~$p$ et que le cours redescend à un niveau $p (1-\beta)$, la position est coupée. A l'inverse, si la stratégie a ouvert une position vendeuse au prix~$p$ et que le cours remonte à un niveau $p (1+\beta)$, la position est aussi coupée.
\end{enumerate}


				\begin{figure}[ht]
				\begin{center}\begin{tabular}{|c|}\hline
    		\includegraphics[height=6cm, width=10cm]{\filext{../python_cours_exemple/image/bnpf}} \\ \hline
    		\end{tabular}\end{center}
    		\caption{ Le cours de la BNP entre début 2003 et mi 2008.}
    		\label{finance_graph_ohlc_bnp}
    		\end{figure}
    		
Cette stratégie très simple est très inefficace sur de courtes périodes très volatiles alors que le cours de l'action sort des bandes de Bollinger puis revient très rapidement à un niveau où la position est coupé par la seconde règle. Une stratégie réellement utilisée par un Hedge Funds s'appuie sur plus d'une dizaine de règles et autant de paramètres.
    	

\subsubsection{Backtest}


				\begin{figure}[ht]
				\begin{center}\begin{tabular}{|c|}\hline
    		\includegraphics[height=4cm, width=8cm]{\filext{../python_cours_exemple/image/navstrat}} \\ 
    		\includegraphics[height=4cm, width=8cm]{\filext{../python_cours_exemple/image/navstratp}}
				 \\ \hline
    		\end{tabular}\end{center}
    		\caption{ NAV de la stratégie Trend Following décrite au paragraphe~\ref{analyse_finace_strategie}. 
    							Le second graphe représente la position de la stratégie, une position positive signifie une position
    							acheteuse (long), une position négative signife une position vendeuse (short). C'est un graphe
    							qui ne représente pas la position mais la quantité d'actions achetées ou vendues pour une position proche de un euros.
    							Ceci explique que cette seconde courbe présente des paliers de hauteurs différentes, il s'agit de l'inverse du prix
    							observé lors de l'ouverture d'une position.}
    		\label{finance_graph_ohlc_bnp_nav_}
    		\end{figure}


La validation d'une stratégie passe par son évaluation sur le passé de l'action sur laquelle on souhaite l'appliquer (voir la figure~\ref{finance_graph_ohlc_bnp_nav_}). On appelle cette méthode \textit{backtest}.\indexfrr{finance}{backtest} Ce passé doit être suffisamment grand~: il n'est pas difficile de concevoir une stratégie gagnante sur six mois, sur dix ans c'est moins facile. Toutefois, cette validation a quelques biais~:

\begin{enumerate}
\item Il est impossible de valider la stratégie sur des situations probables dans le futur mais absentes du backtest. Ceci signifie que la stratégie est susceptible de mal se comporter pour toute situation imprévue.
\item Les situations de crises ne sont pas fréquentes~: elles sont statistiquement peu significatives. Par conséquent, la stratégie n'est validée que sur des jours de trading "normaux" et c'est dans ces périodes qu'elle fait l'essentiel de ses gains. En temps de crise, son comportement peut décevoir.
\item L'utilisation de plus en plus grande de l'informatique a tendance à modifier les comportements du marché. Les algorithmes de trading intraday augmente les volumes échangées. L'introduction des stop order peut provoquer des opérations en cascades. Utiliser vingt ans d'historique est sans doute peu pertinent.
\end{enumerate}

Le backtest n'est pas toujours suffisant pour valider une stratégie. Sur un historique de cinq ans, il n'y figure que quelques crises et certainement pas le scénario de la prochaine. C'est pourquoi il faut être vigilant lors de l'utilisation de telles stratégies ou alors lui faire confiance et supposer que l'algorithme se remettra à gagner une fois la crise passée. Il peut être intéressant de valider la stratégie sur d'autres backtest provenant d'actions plus ou moins corrélées à la première. C'est une autre façon d'améliorer la qualité du backtest.

En règle générale, les stratégies sont éprouvées avec un levier de 100\%~: la position maximale\footnote{La position maximale est la somme des positions acheteuses et vendeuses qui ne soustraient pas~: on fait la somme des valeurs absolues des deux positions.} ne doit pas dépasser la somme initiale. Ce principe permet de comparer les stratégies entre elles. D'autres part, utiliser un levier plus ou plus grand modifie certes les rendements et la volatilité mais ne modifie pas leur rapport. Une bonne stratégie est de préférence une stratégie peu volatile, un levier adéquat permettra d'en augmenter le rendement.

Au final, la validation d'une stratégie sur un backtest aboutit à la courbe des gains ou Net Asset Value (NAV), ce sont les gains qui ne tiennent pas compte des frais de gestion, des charges de la société financière.\indexfrr{finance}{NAV} Il est fréquent aussi qu'on parle de NAV non réinvestie, ceci signifie que la position est constante tout le temps du backtest même si en réalité, les gains sont réinvestis. 

On observe souvent que la recherche de la meilleure stratégie sur un backtest donne des résultats nettement supérieure à ceux que la stratégie obtient lorsqu'elle est vraiment utilisée. Ceci signifie aussi que la stratégie est parfaite sur le passé~: elle est trop bien ajustée. Cee écueil est quasiment inévitable, il est très difficile de savoir si une stratégie est trop performante sur le passé et risque de ne plus l'être après.

\begin{xremark}{plusieurs ordres passés dans la même journée}
Lors de la simulation d'une stratégie sur un backtest, il peut arriver que plusieurs ordres soient passés durant la même journée. Il est impossible de savoir dans quel ordre ceux-ci doivent être passés car seules quatre prix sont connus au cours de cette période. Il n'est pas possible de savoir si la valeur maximale a été atteinte avant la valeur minimale par exemple. On suppose malgré tout que ce genre de situation a peu d'impact sur le résultat final. S'il survient de façon trop fréquente, alors il serait sans doute avisé d'en tenir compte lors de l'attribution de valeurs aux coûts de transactions et au slippage définis ci-dessous.
\end{xremark}


\subsubsection{Modélisation}

Pour améliorer la validation des stratégies sur un backtest, on intègre dans le modèle deux défauts qui surviennent lors des passages d'ordres. Même utilisée sur des marchés liquides, si la stratégie impose un achat d'action à un prix donné~$p$, il y a toujours un décalage entre le temps où le prix dépasse ce niveau~$p$ et celui où l'ordre est passé. Ce décalage ou \textit{slippage}\indexfrr{finance}{slippage} peut être dans un sens ou dans l'autre mais par principe, ce décalage sera toujours supposé être en défaveur de la stratégie. 

Le slippage est souvent exprimé en nombre de \textit{tick}.\indexfrr{finance}{tick} En effet, le prix de tout produit côté n'est pas continu, il évolue de tick en tick. Le tick est une fraction de l'action et dépend de chaque action. Une action de 5 euros aura un tick faible, le tick d'une action de 1000 euros sera plus élevé. Un bon ordre de grandeur pour le slippage est de quelques tick.

Passer des ordres a un coût, de quelques pourcents du prix de l'action pour un particulier, de quelques dizième de pourcents pour un Hedge Fund. Une stratégie performante mais qui beaucoup d'ordres gagnera moins d'argent. Ce sont des paramètres qu'il ne faut pas négliger pour des stratégies Mean Reversing qui cherchent à profiter d'une forte volatilité grâce à de fréquents passages d'ordres. Il faut prendre en compte ce qu'on appelle les \textit{coûts de transaction}.\indexfrr{finance}{coût de transaction}

Ces deux défauts peuvent être mesurés une fois que la stratégie est mise en place. Néanmoins, il est préférable de les surestimer pour tenir compte du fait qu'une fois validée sur backtest, la stratégie sera toujours utilisée sur des données nouvelles. Certains Hedge Funds donnent à ces paramètres non pas les valeurs qu'ils observent en pratique mais des valeurs plus fortes qui leur permettent de faire décroître les performances des backtests jusqu'aux performances réellement observées.

				\if 0
				La figure~\ref{finance_graph_ohlc_bnp_nav_cost} le résultat de la stratégie en tenant compte des coûts de transactions 
				et du slippage. Les résultats sont moins importants même si l'impact est ici peu visible car la stratégie effectue peu
				 d'opérations et que l'historique est court (cinq ans seulement). Ce paramètre a d'autant plus d'importance que le nombre
				  d'ordre augmente, il serait inconcevable d'oublier ces deux défauts dans le cas d'une stratégie intraday.


				\begin{figure}[ht]
				\begin{center}\begin{tabular}{|c|c|}\hline
    		\includegraphics[height=4cm, width=7cm]{\filext{../python_cours_exemple/image/navstrat}} &
    		\includegraphics[height=4cm, width=7cm]{\filext{../python_cours_exemple/image/navstratc}}
				 \\ \hline
    		\end{tabular}\end{center}
    		\caption{ NAV de la stratégie Trend Following décrite au paragraphe~\ref{analyse_finace_strategie} en tenant
    							compte des coûts de transaction (première image) et sans en tenir compte (seconde image).
    							Sur ce genre de stratégies, les coûts de transactions ont peu d'impact car le nombre d'ordres passés
    							est faible. L'importance de ces paramètres croît en fonction du nombre d'ordres.}
    		\label{finance_graph_ohlc_bnp_nav_cost}
    		\end{figure}
				\fi    		

Le slippage est ici modélisé comme une constante mais il serait sans doute plus judicieux de l'ajuster en fonction d'une variabilité locale (par rapport à la différence High - Low) qui pourrait pénaliser davantage la stratégie en temps de crise. Par exemple, lors de la vente d'une action au prix~$p$, on considèrera le prix $p - \alpha \abs{p} - \beta$. $\alpha$ est le coût de transaction est proportionnelle au prix, $\beta$ est le slippage qui s'exprime en un multiple entier du tick (donc différent pour chaque action).




\subsubsection{Résultats standards}

Même si le rendement d'une stratégie est le résultat important, il faut aussi regarder comment il est obtenu. C'est pour cela qu'on regarde d'autres indicateurs comme l'Information Ratio ou le ratio de Sharpe. La première étape consiste à annualiser la performance et la volatilité obtenus sur le backtest (voir paragraphe~\ref{finance_rendemnt_annee}). On cherche ensuite à construire le tableau suivant qui n'est pas exhaustif~: \indexfrr{finance}{Information Ratio}\indexfrr{finance}{ratio de Sharpe}\indexfrr{finance}{drawdown}\indexfrr{finance}{rendement roulant}

\begin{center}\begin{tabular}{|l|p{13cm}|} \hline
Information Ratio & C'est le rendement rapporté sur la volatilité $\frac{R}{\sigma}$. 
										$R$ mesure la performance, $\sigma$ le risque pour l'obtenir. Si ce ratio est inférieur à~1, 
										cela signifie que le risque est plus élevé que la performance qui est sujette à caution
										même si elle est importante. \\ \hline
ratio de Sharpe   & Les Hedge Funds partiquent souvent un levier supérieur à~200\%. Cela veut dire qu'ils empruntent pour 
										placer le double ou le triple de l'argent qu'ils gèrent. Cet emprunt n'est pas gratuit, c'est pourquoi on 
										retranche à la performance obtenu par le Hedge Fund le taux sans risque~$r$ qui correspond au taux de l'emprunt~:
										$\frac{R-r}{\sigma}$. \\ \hline
drawdown 					& C'est la perte maximale de la stratégie. Obtenir 10\% en fin d'année ne veut pas dire que le système n'est pas
									  passé par -5\% en cours d'année. La perte maximale n'est pas le niveau le plus bas depuis le début de l'année, 
									  c'est le plus grand écart entre un gain maximal et une perte maximale qui lui succède. \\ \hline
rendement roulant & Lorsqu'on construit une stratégie à long terme, il peut être intéressant de construire la courbe des rendements
										roulant qui est par exemple pour une date~$t$, la performance obtenue entre $t- 6 mois$~et~$t$ par exemple. 
										Pour une stratégie à long terme, il devrait exister très peu de rendements roulant à un an négatifs. \\ \hline
corrélation				& Lorsqu'un investisseur cherche à investir son argent dans un placement alternatif, il regarde si ce placement
										lui offre des rendements qui ne sont pas corrélés au marché. Dans le cas d'une stratégie appliquée à une
										action, il s'agit de calculer la corrélation entre le cours de l'action et la NAV de la stratégie.
										Une corrélation de 1 ou -1 signifie que la stratégie a été d'acheter ou de vendre une action puis
										de conserver cette position. Il est intéressant d'avoir une corrélation faible, d'avoir une stratégie
										qui ne reproduisent pas les pertes et les gains d'une action. C'est aussi avoir de la valeur 
										ajoutée~: la stratégie atteint son objectif, elle propose un placement alternatif.\\ \hline
\end{tabular}\end{center}										

Il existe de nombreuses manières de mesurer la performance d'une stratégie. D'autres critères peuvent être mesurés comme le nombre d'ordres passés, la VAR (Value At Risk)\indexfrr{finance}{VAR} qui mesure les pertes maximales quotidiennes\footnote{Pour calculer la VAR, on considère les rendements de l'année écoulée qu'on trie par ordre croissant. On considère que les plus grandes pertes représentent ce que la stratégie peut perdre au pire le lendemain. Ce calcul est appelé VAR historique.}. Cela dépend de la stratégie et des écueils qu'on la souhaite la voir éviter.

Il est également intéressant de se pencher sur les plus mauvais jours comme les meilleurs jours de la stratégie obtenus sur le backtest. Leur étude fournit en général des informations importantes sur son comportement en temps de crise. Le tableau~\ref{finance_graph_ohlc_bnp_nav_result} présente les résultats pour la stratégie décrite au paragraphe~\ref{analyse_finace_strategie}.

				\begin{table}[ht]
				\begin{center}\begin{tabular}{|l|r|}\hline
				rendement annualisé 	& 7,7 \% 		\\ \hline
				volatilité annualisée & 8,5 \%		\\ \hline
				Information Ratio 		&	0.88		\\ \hline
				ratio de Sharpe 			& 0.42   	\\ \hline
				corrélation 					& 82.6 \% 		\\ \hline
				drawdown 							& 24.4 \%		\\ \hline
    		\end{tabular}\end{center}
    		\caption{ Statistiques classiques permettant de mesurer la performance de la stratégie décrite au
    							paragraphe~\ref{analyse_finace_strategie}. La stratégie est ici peu efficace. La volatilité est élevée,
    							le drawdown maximal est très élevé. }
    		\label{finance_graph_ohlc_bnp_nav_result}
    		\end{table}

\subsubsection{Variation de paramètres}

Une stratégie dépend de paramètres. Un trend following simple dépend de la longueur de la moyenne mobile (20, 200 jours) et de l'écart entre les bandes de Bollinger. On peut se poser la question de savoir si la stratégie est sensible ou non à la modification d'un paramètre. Etant donné que les stratégies sont testées sur un backtest, les paramètres sont ajustés en fonction de ce backtest, une stratégie sensible à un paramètre signifie qu'un backtest un peu différent aura vraisemblement des répercussions importantes sur la performance de la stratégie.

Dans le cas de notre stratégie, on a fait varier les trois paramètres et mesurer le rendement et la volatilité pour chaque expérience. Ceci aboutit aux graphes de la figure~\ref{finance_graph_ohlc_bnp_nav_var}.

				\begin{figure}[ht]
				\begin{center}\begin{tabular}{|c|c|c|}\hline
    		\includegraphics[height=5cm, width=5cm]{\filext{../python_cours_exemple/image/stratdist}} &
    		\includegraphics[height=5cm, width=5cm]{\filext{../python_cours_exemple/image/stratstop}} &
    		\includegraphics[height=5cm, width=5cm]{\filext{../python_cours_exemple/image/stratmale}} \\ \hline
    		$\alpha$ & $\beta$ & $d$ \\ \hline
    		\end{tabular}\end{center}
    		\caption{ Variations selon les trois paramètres $\alpha$, $\beta$, $d$. 
    							Le pic obtenu pour la valeur $\alpha\sim 1.2$ est très localisé
    							autour de cette valeur, il faut s'attendre à ce que la stratégie obtienne des résultats très différents
    							sur des séries similaires. La courbe pour $\beta$ est stable, on choisira une valeur dans cette zone.
									Les rendements passent du simple au double en fonction de la largeur 
    							des bandes de Bollinger. Ces graphes ne montrent que l'évolution des rendements et de la volatilité,
    							ils pourraient aussi montrer l'évolution des drawdowns ou du ratio de Sharpe.}
    		\label{finance_graph_ohlc_bnp_nav_var}
    		\end{figure}


\subsubsection{Autres séries financières de même nature}

Il existe nécessairement d'autres séries financières corrélées avec celles du backtest. Si le backtest est le cours de l'action d'une banque, il faut tester la stratégie sur l'action d'une autre banque pour vérifier qu'elle a le même comportement sur une série fortement corrélée. Ceci permet de confirmer la robustesse de la stratégie.

A l'inverse, il est également souhaitable de tester la stratégie sur des séries financières décorrélées, issues de secteurs économiques différents. Deux conclusions sont possibles, soit la stratégie est encore positive auquel cas elle est très robuste, soit la stratégie présente des résultats négatifs qui permettront peut-être d'appréhender les limites de l'algorithme et de pouvoir identifier des scénari dans lesquels la stratégie ne produira pas de bons résultats.

La figure~\ref{finance_graph_ohlc_bnp_autres} montre les cours de trois banques, la BNP, la Société Générale, le Crédit Agricole et une série issue d'un autre secteur Danone. La table~\ref{finance_graph_ohlc_correlation} contient la matrice des autocorrélations. Enfin, la figure~\ref{finance_graph_ohlc_bnp_autres_result} montre les résultats de la stratégie sur chacune des quatre séries.

				\begin{figure}[ht]
				\begin{center}\begin{tabular}{|c|c|}\hline
    		\includegraphics[height=4cm, width=7cm]{\filext{../python_cours_exemple/image/bnpf}} &
    		\includegraphics[height=4cm, width=7cm]{\filext{../python_cours_exemple/image/socgenf}} \\ \hline
    		\includegraphics[height=4cm, width=7cm]{\filext{../python_cours_exemple/image/caf}} &
    		\includegraphics[height=4cm, width=7cm]{\filext{../python_cours_exemple/image/danone}}  \\ \hline
    		\end{tabular}\end{center}
    		\caption{ Quatre actions, trois banquaires (BNP, Société Générale, Crédit Agricole) et une société
    							issue de l'alimentaire Danone.}
    		\label{finance_graph_ohlc_bnp_autres}
    		\end{figure}

				\begin{table}[ht]
				\begin{center}\begin{tabular}{|l|r|r|r|r|} \hline
				& \textbf{BNP} 		& \textbf{SG} & \textbf{CA} & \textbf{Danone} \\ \hline
				\textbf{BNP} 			& 1,00  &  0,75  &  0,67  &  0,44   \\ \hline
				\textbf{SG}  			& 0,75  &  1,00  &  0,63  &  0,42   \\ \hline
				\textbf{CA}  			& 0,67  &  0,63  &  1,00  &  0,35   \\ \hline
				\textbf{Danone}  	& 0,44  &  0,42  &  0,35  &  1,00   \\ \hline
				\end{tabular}\end{center}
    		\caption{ Matrice des autocorrélations pour les rendements quotidiens des quatre actions 
    							BNP, Société Générale, Crédit Agricole et Danone. Les corrélations sont moins fortes entre Danone et
    							une banque qu'entre banques. Bien que les données quotidiennes soient beaucoup plus propres que des données intraday,
    							il faut quand même vérifier que les séries sont homogènes et contiennent 
    							les mêmes dates avant de calculer les corrélations sur les rendements.}
    		\label{finance_graph_ohlc_correlation}
    		\end{table}

				\begin{figure}[ht]
				\begin{center}\begin{tabular}{|c|c|}\hline
    		\includegraphics[height=4cm, width=7cm]{\filext{../python_cours_exemple/image/rbnpf}} &
    		\includegraphics[height=4cm, width=7cm]{\filext{../python_cours_exemple/image/rsocgenf}} \\
    		BNP & Société Générale \\ \hline
    		\includegraphics[height=4cm, width=7cm]{\filext{../python_cours_exemple/image/rcaf}} &
    		\includegraphics[height=4cm, width=7cm]{\filext{../python_cours_exemple/image/rdanf}}  \\
    		Crédit Agricole & Danone \\ \hline
    		\end{tabular}\end{center}
    		\caption{ La stratégie Trend Following est appliquée aux quatre séries avec des résultats mitigés. 
    							Elle réagit bien sur la BNP et la Société Générale, elle donne de mauvais résultats sur le Crédit Agricole.
    							Sur Danone, la stratégie conserve une position acheteuse puis perd 
    							tout ce qu'elle avait gagné par la suite alors que la 
    							série n'a plus de trend aussi évident et que sa volatilité est élevée.
    							La série du Crédit Agricole est plus longue de deux ans mais cela n'explique pas ses mauvais résultats,
    							la stratégie prend une série de mauvaises décisions ce qui tend à montrer qu'elle n'est pas suffisamment robuste.}
    		\label{finance_graph_ohlc_bnp_autres_result}
    		\end{figure}
    		
Il est très peu probable qu'une stratégie soit efficace sur chaque action mais il est souhaitable qu'elle soit positive sur des séries corrélées et qu'elle limite les pertes sur les autres séries financières.



\subsubsection{Décomposition en deals}
\indexfrr{finance}{deal}

Ce procédé permet parfois de découvrir le style d'une stratégie ou de mesurer la pertinence de l'algorithme lorsqu'il coupe sa pose. Un \textit{deal} est le fait d'ouvrir puis de fermer une position comme le décrit la figure~\ref{finance_graph_ohlc_position_deal}. Un deal est donc défini par~:
\begin{enumerate}
\item une date d'ouverture de la position $t_1$
\item une date de fermeture de la position $t_2$
\item la quantité $q$ (positive si on a acheté, négative si on a vendu)
\item le prix d'ouverture $p_1$
\item le prix de fermeture $p_2$
\end{enumerate}

				\begin{figure}[ht]
				\begin{center}\begin{tabular}{|c|}\hline
    		\includegraphics[height=4cm, width=8cm]{\filext{../python_cours_exemple/image/posdeal}}     		\\ \hline
    		\end{tabular}\end{center}
    		\caption{ Les deals sont construits à partir de la position de la stratégie. Chaque flèche à double sens désigne un deal
    						  Lorsqu'un ordre d'achat est passé alors que la position est déjà positive, on décompose en deal dont les temps de vie
    						  se superposent.}
    		\label{finance_graph_ohlc_position_deal}
    		\end{figure}

Ces informations permettent de calculer le gain associé au deal~: $q(p_2 - p_1)$. Si on note un deal comme un 5-uplet $d_i=\pa{t_1^i,t_2^i,q^i,p_1^i,p_2^i}$, le gain de la stratégie sur l'ensemble du backtest devient~: $\sum_i  q^i(p_2^i - p_1^i)$. Cette décomposition s'inspire de l'article \citeindex{Potters2005} qui étudie la répartition des gains d'une stratégie Trend Following, elle présente des caractéristiques qui la différencie d'autres stratégies. Un Trend Following se reconnaît car il aboutit à un grand nombre de petits deals négatifs et quelques gros deals positifs comme le montre la figure~\ref{finance_graph_ohlc_deal}. 

				\begin{figure}[ht]
				\begin{center}\begin{tabular}{|c|c|c|}\hline
    		\includegraphics[height=6cm, width=6cm]{\filext{../python_cours_exemple/image/bouchaud}} &
    		\includegraphics[height=5cm, width=5cm]{\filext{../python_cours_exemple/image/stratdd}}  &
    		\includegraphics[height=5cm, width=5cm]{\filext{../python_cours_exemple/image/stratddu}}  
    		\\ \hline
    		\end{tabular}\end{center}
    		\caption{ La première image est celle de la distribution théorique des gains calculée par 
    							Bouchaud et Potters dans leur article \cite{Potters2005}.
    							La distribution empirique n'est pas toujours facile à construire sur des historiques qui ne sont pas assez longs~:
    							dans le cas de notre stratégie Trend Following, il n'existe que cinq deals.
    							Il faut donc assembler les deals de la même stratégie sur plusieurs séries. Le résultat
    							correspond assez bien à la distribution théorique. Le troisème graphe représente la distribution
    							des durées des deals exprimées en jours (axe des abscisses). Les deals négatifs sont nombreux et de 
    							courtes durées.}
    		\label{finance_graph_ohlc_deal}
    		\end{figure}
    		
On peut s'interroger sur le cas d'une stratégie exclusivement Trend Following dont la distribution des deals sur backtest est différente de ce profil décrit par la figure~\ref{finance_graph_ohlc_deal}. Ses paramètres pourraient avoir été trop bien calculés pour s'ajuster au backtest, ceci implique que cette stratégie aurait sans doute plus de mal à reproduire des rendements équivalents sur des données futures. On peut envisager cette distribution comme un test statistique.
    	
Le second intérêt de la décomposition en deals est le calcul de la perte et du gain maximale que la stratégie aurait pu observer en coupant plus tôt sa position. On définit $H(t_1,t_2)$ le prix maximal observé dans la période $\cro{t_1,t_2}$ et $L(t_1,t_2)$ le prix minimal observé dans la même période. Pour chaque deal long (position positive), ces deux prix vérifient l'inégalité~:
\begin{eqnarray}
q \pa{L(t_1,t_2) - p_1}  \infegal q(p_2 - p_1) \infegal q \pa{H(t_1,t_2) - p_1}
\end{eqnarray}
%
Le graphe $\pa{  q(p_2 - p_1), \; q \pa{H(t_1,t_2) - p_1} }$ permet de représenter l'écart entre le gain et le gain maximal qu'on aurait pu obtenir sur chaque deal long. Un deal short (position négative), on s'intéresse à l'ensemble des points $\pa{  q(p_2 - p_1), \; q \pa{L(t_1,t_2) - p_1 } }$.
Ceci est illustré par le graphe~\ref{finance_graph_ohlc_deal_line}.

				\begin{figure}[ht]
				\begin{center}\begin{tabular}{|c|}\hline
    		\includegraphics[height=7cm, width=7cm]{\filext{../python_cours_exemple/image/stratd}}  
    		\\ \hline
    		\end{tabular}\end{center}
    		\caption{ Dans ce graphe, pour un deal positif, plus il est proche de la diagonale, plus la décision de coupure
    							de la position a été proche du maximum envisageable. Dans ce graphe, on voit que la stratégie est meilleure 
    							lorsqu'elle coupe une position vendeuse plutôt qu'acheteuse. Il faudrait sans doute pour l'améliorer
    							tenir compte du signe de la position avant de couper même si cette conclusion est osée
    							étant donné le peu de deals short positifs. }
    		\label{finance_graph_ohlc_deal_line}
    		\end{figure}




\subsubsection{Pour aller plus loin}

Sur des stratégies Trend Following, le passé d'une action ne suffit pas à tester une stratégie~: moins d'une dizaine d'ordres vont être exécutés. La première solution est de tester cette stratégie sur plus de séries similaires. La seconde solution est plus ambitieuse car elle suppose l'altération de la série initiale.

Le premier objectif est de créer une série proche mais suffisamment différente pour tester la robustesse de la stratégie. On peut par exemple construire une seconde série où chaque rendement quotidien sera tiré aléatoirement parmi les cinq derniers rendements quotidiens. Le second objectif est d'ajouter à la série des scénarios de crises. On peut soit s'inspirer des crises déjà présentes ou créer artificiellement des scénarios volontairement exagérés de façon à tester la stratégie dans des cas extrêmes. 

Bruiter les séries financières est un projet ambitieux en terme de conception et de temps de calcul. Certaines directions de recherches visent à modéliser les acteurs des marchés financiers pour reproduire artificiellement le fonctionnement d'une salle des marchés et ses crises. Cette voie est plus proche de l'intelligence artificielle, des sytèmes multi-agents ou de la microéconomie que de la finance elle-même.




\subsection{Diversification}

Gagner de l'argent à partir d'une seule stratégie et d'une seule action est beaucoup trop risqué. Il faut constuire un portefeuille afin de réduire les risques. Ce portefeuille n'est plus simplement composé d'actions mais de couples action - stratégie qui sont décrits par un rendement et une volatilité.

L'objectif reste le même que celui présenté au paragraphe~\ref{finance_portefeuille_build} et sa résolution est identique également. L'intérêt de combiner des actions de secteurs économiques différents est toujours de composer un portefeuille d'actions qui ne soient pas trop corrélées afin d'éviter que toutes les actions montent ou baissent en même temps.

Une stratégie n'est jamais performante tout le temps, l'intérêt de combiner des stratégies différentes sur la même action est de pouvoir compenser la perte d'un algorithme par le gain d'un autre. Autrement dit, la combinaison de plusieurs stratégies ne sera pas forcément plus rentable mais aura tendance à faire diminuer la volatilité.


\subsection{Conclusion}

Ce document présente quelques concepts qui permettent de mieux appréhender la conception d'un algorithme automatique de trading. Ils suppléent de plus en plus les traders et comme ils accélèrent la vitesse des échanges, il devient difficile de s'en passer. Les stratégies présentées ne sont pas assez évoluées pour être performantes, il serait préférable de se tourner vers des techniques issues du machine learning. En règle générale, si une stratégie est connue, c'est qu'elle ne fonctionne plus.

Il faut retenir que ces techniques, de par la manière dont elles sont construites, capturent un fonctionnement normal des séries et sont plus ou moins imprévisibles en temps de crise. Plus elles sont rapides, plus il est essentiel de les tester en profondeur. Il ne faut pas choisir des paramètres qui maximisent seulement leur rendement, il est préférable d'intégrer une notion de risque dans le critère à optimiser car construire un tel algorithme revient à résoudre un problème d'optimisation.




\subsection{Programmes informatiques}

\subsubsection{Dessin d'une série financière}

La plupart des résultats issus d'une stratégie automatique de trading sont des graphes. Le premier d'entre eux est d'une série financière pour laquelle on connaît les cours \textit{Open High Low Close} de chaque jour. Ces graphes sont spécifiques au domaine de la finance et ils ne sont pas toujours faciles à créer avec des modules comme \codes{MatPlotLib}.\indexmoduleext{matplotlib}\indexfrr{finance}{Open}\indexfrr{finance}{High}\indexfrr{finance}{Low}\indexfrr{finance}{Close}\indexfrr{finance}{graphe} Les données sont souvent conservées dans des fichiers texte dont le format ressemble à celui qui suit.
%
\begin{verbatimx}
Date      Open   High   Low    Close  Volume
20/03/08  56.01  56.75  55.26  55.84  2434000
19/03/08  57.53  57.95  56.40  56.77  2714400
18/03/08  58.85  58.99  57.13  57.61  3265900
14/03/08  60.27  60.78  59.00  59.53  2105500
13/03/08  59.01  60.47  59.00  60.15  2702700
12/03/08  60.84  60.85  59.35  60.02  2982400
11/03/08  61.12  61.56  60.00  60.47  2480900
\end{verbatimx}
%
L'objectif est d'obtenir le graphe de la figure~\ref{finance_graph_ohlc_figure1} dans lequel figurent les prix OHLC (\textit{Open High Low Close}),\indexfrr{finance}{OHLC} les volumes et aussi les dates qui permettent de relier cette série à des événements économiques comme la crise des subprimes qui a commencé en été~2007.
%
\inputcode{../python_cours_exemple/programme/graphohlc.py}{graphe d'une série financière}
%

				\begin{figure}[ht]
				\begin{center}\begin{tabular}{|c|}\hline
    		\includegraphics[height=6cm, width=10cm]{\filext{../python_cours_exemple/image/edf}} \\ \hline
    		\end{tabular}\end{center}
    		\caption{Graphe \textit{Open-High-Low-Close-Volume} d'une série financière.}
    		\label{finance_graph_ohlc_figure1}
    		\end{figure}
    		
    		
\firstpassagedo{
	\subsection{Bibliographie}
	\begin{thebibliography}{99}
	\input{../python_cours_exemple/finance_autostrat_biblio.tex}
	\end{thebibliography}
	%\section{Index}
	\begin{flushleft}
	\printindex
	\end{flushleft}
}
    		


\input{../../common/paper_end.tex}%

